<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinosaurie √Ñventyr</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 100%);
            touch-action: none;
        }
        
        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        .control-btn {
            position: absolute;
            bottom: 30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.8);
            background: rgba(100,100,100,0.6);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            cursor: pointer;
            z-index: 10;
            touch-action: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .control-btn:active {
            background: rgba(150,150,150,0.8);
            transform: scale(0.95);
        }
        
        #leftBtn {
            left: 30px;
        }
        
        #rightBtn {
            left: 130px;
        }
        
        #jumpBtn {
            right: 30px;
            background: rgba(255,165,0,0.7);
            border-color: rgba(255,200,0,0.9);
        }
        
        #jumpBtn:active {
            background: rgba(255,200,0,0.9);
        }
        
        #startScreen, #levelComplete {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.7);
            z-index: 20;
        }
        
        #startScreen h1, #levelComplete h2 {
            color: white;
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }
        
        #startBtn, #nextLevelBtn {
            padding: 20px 40px;
            font-size: 28px;
            background: linear-gradient(to bottom, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        #startBtn:active, #nextLevelBtn:active {
            transform: scale(0.95);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui">
        <div>Niv√•: <span id="level">1</span></div>
        <div>Po√§ng: <span id="score">0</span></div>
        <div>Liv: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </div>
    
    <div class="control-btn" id="leftBtn">‚óÑ</div>
    <div class="control-btn" id="rightBtn">‚ñ∫</div>
    <div class="control-btn" id="jumpBtn">‚ñ≤</div>
    
    <div id="startScreen">
        <h1>ü¶ñ Dinosaurie √Ñventyr üåü</h1>
        <button id="startBtn">Starta Spel</button>
    </div>
    
    <div id="levelComplete" class="hidden">
        <h2>Niv√• Klarad! üéâ</h2>
        <p style="color: white; font-size: 24px; margin-bottom: 20px;">Po√§ng: <span id="levelScore">0</span></p>
        <button id="nextLevelBtn">N√§sta Niv√•</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Game state
        let gameState = {
            level: 1,
            score: 0,
            lives: 3,
            isPlaying: false
        };
        
        // Player
        const player = {
            x: 100,
            y: 0,
            width: 40,
            height: 50,
            velocityY: 0,
            velocityX: 0,
            speed: 5,
            jumpPower: 15,
            gravity: 0.6,
            isJumping: false,
            onGround: false,
            hasDoubleJump: false,
            doubleJumpUsed: false
        };
        
        // Controls
        const keys = {
            left: false,
            right: false,
            jump: false
        };
        
        // Platforms
        let platforms = [];
        
        // Stars (collectibles)
        let stars = [];
        
        // Dinosaurs (enemies)
        let dinosaurs = [];
        
        // Power-ups
        let powerUps = [];
        
        // Initialize levels with carefully balanced star heights
        function initLevel(level) {
            platforms = [];
            stars = [];
            dinosaurs = [];
            powerUps = [];
            
            const groundHeight = canvas.height - 80;
            const maxJumpHeight = 220; // Maximum reachable height with single jump
            const doubleJumpHeight = 380; // Maximum with double jump
            
            // Ground platform
            platforms.push({
                x: 0,
                y: groundHeight,
                width: canvas.width,
                height: 80
            });
            
            if (level === 1) {
                // Level 1 - Tutorial level with easy stars
                platforms.push(
                    { x: 300, y: groundHeight - 120, width: 150, height: 20 },
                    { x: 550, y: groundHeight - 180, width: 150, height: 20 },
                    { x: 800, y: groundHeight - 120, width: 150, height: 20 }
                );
                
                // Stars at reachable heights
                stars.push(
                    { x: 375, y: groundHeight - 200, width: 30, height: 30 },
                    { x: 625, y: groundHeight - 260, width: 30, height: 30 },
                    { x: 875, y: groundHeight - 200, width: 30, height: 30 }
                );
                
                // One slow dinosaur
                dinosaurs.push({
                    x: 600,
                    y: groundHeight - 60,
                    width: 50,
                    height: 60,
                    speed: 1.5,
                    direction: 1,
                    minX: 500,
                    maxX: 900
                });
                
            } else if (level === 2) {
                // Level 2 - Introducing double jump power-up
                platforms.push(
                    { x: 250, y: groundHeight - 100, width: 120, height: 20 },
                    { x: 450, y: groundHeight - 180, width: 120, height: 20 },
                    { x: 650, y: groundHeight - 140, width: 120, height: 20 },
                    { x: 850, y: groundHeight - 200, width: 120, height: 20 }
                );
                
                // Mix of low and high stars
                stars.push(
                    { x: 310, y: groundHeight - 170, width: 30, height: 30 },
                    { x: 510, y: groundHeight - 250, width: 30, height: 30 },
                    { x: 710, y: groundHeight - 210, width: 30, height: 30 },
                    { x: 910, y: groundHeight - 340, width: 30, height: 30 } // Needs double jump
                );
                
                // Double jump power-up
                powerUps.push({
                    x: 510,
                    y: groundHeight - 260,
                    width: 35,
                    height: 35,
                    type: 'doubleJump'
                });
                
                dinosaurs.push(
                    { x: 400, y: groundHeight - 60, width: 50, height: 60, speed: 2, direction: 1, minX: 200, maxX: 600 },
                    { x: 800, y: groundHeight - 60, width: 50, height: 60, speed: 1.8, direction: -1, minX: 700, maxX: 1000 }
                );
                
            } else if (level === 3) {
                // Level 3 - More complex platforming
                platforms.push(
                    { x: 200, y: groundHeight - 80, width: 100, height: 20 },
                    { x: 350, y: groundHeight - 140, width: 100, height: 20 },
                    { x: 500, y: groundHeight - 200, width: 100, height: 20 },
                    { x: 700, y: groundHeight - 160, width: 100, height: 20 },
                    { x: 900, y: groundHeight - 100, width: 100, height: 20 }
                );
                
                stars.push(
                    { x: 250, y: groundHeight - 150, width: 30, height: 30 },
                    { x: 400, y: groundHeight - 210, width: 30, height: 30 },
                    { x: 550, y: groundHeight - 330, width: 30, height: 30 }, // Requires double jump
                    { x: 750, y: groundHeight - 230, width: 30, height: 30 },
                    { x: 950, y: groundHeight - 170, width: 30, height: 30 }
                );
                
                powerUps.push({
                    x: 400,
                    y: groundHeight - 220,
                    width: 35,
                    height: 35,
                    type: 'doubleJump'
                });
                
                dinosaurs.push(
                    { x: 300, y: groundHeight - 60, width: 50, height: 60, speed: 2.5, direction: 1, minX: 150, maxX: 450 },
                    { x: 650, y: groundHeight - 60, width: 50, height: 60, speed: 2.2, direction: -1, minX: 600, maxX: 850 }
                );
                
            } else {
                // Level 4+ - Progressive difficulty
                const numPlatforms = Math.min(5 + level, 8);
                for (let i = 0; i < numPlatforms; i++) {
                    platforms.push({
                        x: 150 + i * 150,
                        y: groundHeight - (80 + Math.random() * 150),
                        width: 80 + Math.random() * 60,
                        height: 20
                    });
                }
                
                // Ensure stars are reachable
                platforms.forEach((plat, i) => {
                    if (i > 0 && Math.random() > 0.3) {
                        const starHeight = plat.y - 70 - (Math.random() * 60);
                        stars.push({
                            x: plat.x + plat.width / 2 - 15,
                            y: starHeight,
                            width: 30,
                            height: 30
                        });
                    }
                });
                
                // Add power-up
                if (platforms.length > 2) {
                    const plat = platforms[Math.floor(platforms.length / 2)];
                    powerUps.push({
                        x: plat.x + plat.width / 2 - 17,
                        y: plat.y - 50,
                        width: 35,
                        height: 35,
                        type: 'doubleJump'
                    });
                }
                
                const numDinos = Math.min(2 + Math.floor(level / 2), 4);
                for (let i = 0; i < numDinos; i++) {
                    const minX = 200 + i * 250;
                    const maxX = minX + 300;
                    dinosaurs.push({
                        x: minX,
                        y: groundHeight - 60,
                        width: 50,
                        height: 60,
                        speed: 1.5 + level * 0.3,
                        direction: i % 2 === 0 ? 1 : -1,
                        minX: minX,
                        maxX: maxX
                    });
                }
            }
            
            player.x = 100;
            player.y = groundHeight - 200;
            player.velocityY = 0;
            player.velocityX = 0;
            player.isJumping = false;
            player.hasDoubleJump = false;
            player.doubleJumpUsed = false;
        }
        
        // Draw player (cute character)
        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            
            // Body
            ctx.fillStyle = '#FF6B9D';
            ctx.beginPath();
            ctx.arc(0, 0, player.width/2, 0, Math.PI * 2);
            ctx.fill();
            
            // Eyes
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(-8, -8, 6, 0, Math.PI * 2);
            ctx.arc(8, -8, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(-8, -8, 3, 0, Math.PI * 2);
            ctx.arc(8, -8, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Smile
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(0, 0, 10, 0, Math.PI);
            ctx.stroke();
            
            // Double jump indicator
            if (player.hasDoubleJump) {
                ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
                ctx.beginPath();
                ctx.arc(0, 0, player.width/2 + 5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        // Draw platforms
        function drawPlatforms() {
            platforms.forEach(platform => {
                // Grass on top
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                ctx.fillStyle = '#228B22';
                ctx.fillRect(platform.x, platform.y, platform.width, 8);
                
                // Grass blades
                ctx.strokeStyle = '#32CD32';
                ctx.lineWidth = 2;
                for (let i = 0; i < platform.width; i += 10) {
                    ctx.beginPath();
                    ctx.moveTo(platform.x + i, platform.y);
                    ctx.lineTo(platform.x + i, platform.y - 5);
                    ctx.stroke();
                }
            });
        }
        
        // Draw stars
        function drawStars() {
            stars.forEach(star => {
                ctx.save();
                ctx.translate(star.x + star.width/2, star.y + star.height/2);
                ctx.rotate(Date.now() / 500);
                
                ctx.fillStyle = '#FFD700';
                ctx.strokeStyle = '#FFA500';
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                    const x = Math.cos(angle) * 15;
                    const y = Math.sin(angle) * 15;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                ctx.restore();
            });
        }
        
        // Draw dinosaurs
        function drawDinosaurs() {
            dinosaurs.forEach(dino => {
                ctx.save();
                ctx.translate(dino.x + dino.width/2, dino.y + dino.height/2);
                if (dino.direction < 0) ctx.scale(-1, 1);
                
                // Body
                ctx.fillStyle = '#2E7D32';
                ctx.beginPath();
                ctx.ellipse(0, 5, 25, 20, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Head
                ctx.beginPath();
                ctx.ellipse(-10, -10, 15, 12, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Eye
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.arc(-15, -12, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Spikes
                ctx.fillStyle = '#1B5E20';
                for (let i = -10; i < 15; i += 8) {
                    ctx.beginPath();
                    ctx.moveTo(i, -5);
                    ctx.lineTo(i - 4, -15);
                    ctx.lineTo(i + 4, -15);
                    ctx.closePath();
                    ctx.fill();
                }
                
                // Legs
                ctx.strokeStyle = '#2E7D32';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(-10, 25);
                ctx.lineTo(-10, 30);
                ctx.moveTo(10, 25);
                ctx.lineTo(10, 30);
                ctx.stroke();
                
                // Tail
                ctx.beginPath();
                ctx.moveTo(20, 0);
                ctx.quadraticCurveTo(30, -5, 35, 5);
                ctx.lineWidth = 8;
                ctx.stroke();
                
                ctx.restore();
            });
        }
        
        // Draw power-ups
        function drawPowerUps() {
            powerUps.forEach(powerUp => {
                ctx.save();
                ctx.translate(powerUp.x + powerUp.width/2, powerUp.y + powerUp.height/2);
                
                // Floating animation
                const float = Math.sin(Date.now() / 300) * 5;
                ctx.translate(0, float);
                
                if (powerUp.type === 'doubleJump') {
                    // Wings icon
                    ctx.fillStyle = '#FFD700';
                    ctx.strokeStyle = '#FFA500';
                    ctx.lineWidth = 2;
                    
                    // Left wing
                    ctx.beginPath();
                    ctx.ellipse(-10, 0, 8, 12, -0.3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Right wing
                    ctx.beginPath();
                    ctx.ellipse(10, 0, 8, 12, 0.3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                }
                
                ctx.restore();
            });
        }
        
        // Update player physics
        function updatePlayer() {
            // Horizontal movement
            if (keys.left) player.velocityX = -player.speed;
            else if (keys.right) player.velocityX = player.speed;
            else player.velocityX = 0;
            
            player.x += player.velocityX;
            
            // Wrap around screen
            if (player.x < -player.width) player.x = canvas.width;
            if (player.x > canvas.width) player.x = -player.width;
            
            // Gravity
            player.velocityY += player.gravity;
            player.y += player.velocityY;
            
            // Check ground collision
            player.onGround = false;
            platforms.forEach(platform => {
                if (player.x + player.width > platform.x &&
                    player.x < platform.x + platform.width &&
                    player.y + player.height > platform.y &&
                    player.y + player.height < platform.y + platform.height + 10 &&
                    player.velocityY > 0) {
                    
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.isJumping = false;
                    player.onGround = true;
                    player.doubleJumpUsed = false;
                }
            });
            
            // Jump logic
            if (keys.jump && !player.isJumping && player.onGround) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
            } else if (keys.jump && player.hasDoubleJump && !player.doubleJumpUsed && !player.onGround && player.isJumping) {
                player.velocityY = -player.jumpPower;
                player.doubleJumpUsed = true;
            }
            
            // Collect stars
            stars = stars.filter(star => {
                if (Math.abs(player.x + player.width/2 - star.x - star.width/2) < 30 &&
                    Math.abs(player.y + player.height/2 - star.y - star.height/2) < 30) {
                    gameState.score += 100;
                    updateUI();
                    return false;
                }
                return true;
            });
            
            // Collect power-ups
            powerUps = powerUps.filter(powerUp => {
                if (Math.abs(player.x + player.width/2 - powerUp.x - powerUp.width/2) < 35 &&
                    Math.abs(player.y + player.height/2 - powerUp.y - powerUp.height/2) < 35) {
                    if (powerUp.type === 'doubleJump') {
                        player.hasDoubleJump = true;
                    }
                    return false;
                }
                return true;
            });
            
            // Check dinosaur collision
            dinosaurs.forEach(dino => {
                if (player.x + player.width > dino.x &&
                    player.x < dino.x + dino.width &&
                    player.y + player.height > dino.y &&
                    player.y < dino.y + dino.height) {
                    
                    gameState.lives--;
                    updateUI();
                    
                    if (gameState.lives <= 0) {
                        gameOver();
                    } else {
                        player.x = 100;
                        player.y = canvas.height - 300;
                        player.velocityY = 0;
                    }
                }
            });
            
            // Check level complete
            if (stars.length === 0) {
                levelComplete();
            }
        }
        
        // Update dinosaurs
        function updateDinosaurs() {
            dinosaurs.forEach(dino => {
                dino.x += dino.speed * dino.direction;
                
                if (dino.x <= dino.minX || dino.x >= dino.maxX) {
                    dino.direction *= -1;
                }
            });
        }
        
        // Draw background
        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98D8E8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            const cloudOffset = (Date.now() / 50) % canvas.width;
            for (let i = 0; i < 3; i++) {
                const x = (i * 400 - cloudOffset) % canvas.width;
                const y = 50 + i * 80;
                ctx.beginPath();
                ctx.arc(x, y, 30, 0, Math.PI * 2);
                ctx.arc(x + 25, y, 35, 0, Math.PI * 2);
                ctx.arc(x + 50, y, 30, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Sun
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(canvas.width - 100, 80, 40, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Game loop
        function gameLoop() {
            if (!gameState.isPlaying) return;
            
            drawBackground();
            drawPlatforms();
            drawStars();
            drawPowerUps();
            drawDinosaurs();
            drawPlayer();
            
            updatePlayer();
            updateDinosaurs();
            
            requestAnimationFrame(gameLoop);
        }
        
        // Update UI
        function updateUI() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = '‚ù§Ô∏è'.repeat(gameState.lives);
        }
        
        // Level complete
        function levelComplete() {
            gameState.isPlaying = false;
            gameState.level++;
            document.getElementById('levelScore').textContent = gameState.score;
            document.getElementById('levelComplete').classList.remove('hidden');
        }
        
        // Game over
        function gameOver() {
            gameState.isPlaying = false;
            alert('Game Over! Slutpo√§ng: ' + gameState.score);
            gameState.level = 1;
            gameState.score = 0;
            gameState.lives = 3;
            updateUI();
            document.getElementById('startScreen').classList.remove('hidden');
        }
        
        // Start game
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startScreen').classList.add('hidden');
            gameState.isPlaying = true;
            initLevel(gameState.level);
            updateUI();
            gameLoop();
        });
        
        // Next level
        document.getElementById('nextLevelBtn').addEventListener('click', () => {
            document.getElementById('levelComplete').classList.add('hidden');
            gameState.isPlaying = true;
            initLevel(gameState.level);
            gameLoop();
        });
        
        // Touch controls
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys.left = true;
        });
        document.getElementById('leftBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys.left = false;
        });
        
        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys.right = true;
        });
        document.getElementById('rightBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys.right = false;
        });
        
        document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            keys.jump = true;
        });
        document.getElementById('jumpBtn').addEventListener('touchend', (e) => {
            e.preventDefault();
            keys.jump = false;
        });
        
        // Keyboard controls (for testing)
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
            if (e.key === 'ArrowUp' || e.key === ' ') keys.jump = true;
        });
        
        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
            if (e.key === 'ArrowUp' || e.key === ' ') keys.jump = false;
        });
        
        // Resize canvas
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (gameState.isPlaying) {
                initLevel(gameState.level);
            }
        });
    </script>
</body>
</html>